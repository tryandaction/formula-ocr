# Formula OCR - 公式识别工具

📐 将图片中的数学公式转换为 LaTeX 代码的 Web 应用。

## 功能特性

### 核心功能
- 🖼️ 支持拖拽、粘贴、点击上传图片
- 🔄 自动识别数学、物理、化学公式
- 📋 一键复制 LaTeX 代码
- ✏️ 支持编辑识别结果，实时预览

### PDF 公式查看器 (v2.0 新功能)
- 📄 **连续阅读体验** - 像阅读真实文档一样流畅浏览 PDF
- 🔍 **整页公式自动检测** - 自动扫描并高亮所有数学公式
- 🎯 **高级公式检测** (v2.1) - 85-90% 准确率，支持公式类型识别
- 💎 **置信度过滤** (v2.1) - 交互式滑块过滤低质量检测
- 🏷️ **公式类型标签** (v2.1) - 自动识别独立公式和行内公式
- 📊 **增强统计信息** (v2.1) - 显示公式类型分布和置信度分布
- ✨ **直接 OCR 识别** - 点击公式即可识别，无需切换界面
- 📋 **侧边公式面板** - 查看、管理、编辑提取的公式
- 🔗 **双向联动** - PDF 与侧边栏公式双向跳转和高亮
- 💾 **状态缓存** - 切换界面后自动恢复阅读位置
- 📱 **响应式布局** - 桌面端侧边栏、移动端底部抽屉
- ⚡ **虚拟滚动** - 仅渲染可见页面，流畅处理大文档

### 文档解析
- 📄 支持 PDF 文档上传（最大 50MB，100 页）
- 📑 支持 DOCX 文档（最大 20MB）
- 📝 支持 Markdown 文件（最大 5MB）
- 🔍 自动检测文档中的公式区域
- 👁️ 高清文档预览与公式精确定位
- ✅ 批量选择公式进行识别
- ⌨️ 快捷键：Ctrl+滚轮缩放、PageUp/PageDown 翻页、+/- 缩放

### 智能识别增强
- 🎯 公式类型选择（数学/物理/化学）提高准确率
- 📊 图片质量检测（模糊、分辨率、对比度）
- 🔢 多公式分离检测
- 📈 识别置信度显示
- 🧠 **高级公式检测引擎** (v2.1) - 8组件模块化架构
  - 图像预处理（去噪、增强、二值化）
  - 数学符号特征提取（希腊字母、积分、求和等）
  - 内容分类（公式/图片/表格/文本）
  - 公式类型分类（独立/行内）
  - 精确边界检测
  - 多维度置信度评分
  - 智能缓存机制
  - 自动降级策略

### 多格式输出
- 📝 LaTeX - 标准数学排版格式
- 📄 Markdown - 适用于文档和笔记
- 🔢 MathML - 网页数学标记语言
- 🔤 Unicode - 纯文本近似表示

### 用户体验
- 🎨 网格/列表双视图切换
- 🔍 公式搜索过滤
- 📁 按来源分组显示
- 💾 批量导出下载
- 📊 差异对比高亮
- ⌨️ 键盘快捷键支持
- 🖱️ 拖拽排序结果

### 历史记录
- 📜 本地历史记录存储（IndexedDB）
- ⭐ 收藏功能
- 🔍 历史搜索与日期筛选
- 📊 使用统计
- 💾 历史批量导出

### 用户额度

| 用户类型 | 每日限制 | 每月限制 | 批量上传 |
|----------|----------|----------|----------|
| 👤 游客 | 1 次 | 3 次 | 1 张 |
| ✓ 注册用户 | 10 次 | 100 次 | 3 张 |
| 💎 付费用户 | 200 次 | 5000 次 | 20 张 |
| 👑 管理员 | 无限 | 无限 | 无限 |

### 管理员功能

管理员拥有以下特权：
- 🔓 无限使用额度
- 🎭 模拟模式：可切换体验不同用户层级（游客/注册用户/付费用户）
- 📊 查看系统状态

配置管理员邮箱：
```bash
# 在 Worker 中添加管理员邮箱（逗号分隔多个）
npx wrangler secret put ADMIN_EMAILS
# 输入: admin@example.com,another@example.com
```

## 付费方案

| 套餐 | 价格 | 有效期 | 说明 |
|------|------|--------|------|
| 月度会员 | ¥5 | 30天 | 适合轻度使用 |
| 季度会员 | ¥14 | 90天 | 更优惠 |
| 年度会员 | ¥40 | 365天 | 最划算 |

### 支付流程（全自动）

1. 点击"升级会员"选择套餐
2. 系统生成6位验证码，扫码支付时备注该验证码
3. 支付完成后输入验证码，系统自动验证并开通会员
4. 权益即时生效，无需等待人工审核！

## 技术栈

- React 19 + TypeScript
- Vite
- Tailwind CSS
- KaTeX（公式渲染）
- PDF.js（PDF 解析）
- IndexedDB（本地存储）
- 智谱 AI GLM-4V-Flash（视觉模型）
- **高级公式检测引擎** (v2.1)
  - 纯前端实现，零成本
  - 8组件模块化架构
  - 158个测试用例（100%通过率）
  - 85-90%检测准确率
  - <500ms单页检测速度

## 本地开发

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build
```

## 环境变量

复制 `.env.example` 为 `.env` 并配置：

```bash
# 后端 API 地址（部署 Worker 后填写）
VITE_API_BASE=https://formula-ocr-api.your-account.workers.dev

# 或者直连模式（不使用后端）
VITE_ZHIPU_API_KEY=your-api-key
```

## 部署

### 前端部署（Cloudflare Pages / Vercel / Netlify）

1. 连接 Git 仓库
2. 设置环境变量 `VITE_API_BASE`
3. 构建命令：`npm run build`
4. 输出目录：`dist`

### 后端部署

参考 [formula-ocr-worker/README.md](../formula-ocr-worker/README.md)

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+V` | 粘贴图片 |
| `Ctrl+C` | 复制选中公式 |
| `Delete` | 删除选中结果 |
| `↑/↓` | 导航选择 |
| `Enter` | 展开/收起 |
| `Esc` | 取消选中 |

## 常见问题

### 识别准确率如何？
对于清晰的公式图片，准确率可达 95% 以上。建议上传清晰、对比度高的图片。

### 支持哪些类型的公式？
支持数学公式、物理公式、化学方程式等，包括分数、根号、积分、求和、矩阵等复杂符号。

### 文档解析功能支持哪些格式？
目前支持 PDF（最大 50MB，100 页）、DOCX（最大 20MB）、Markdown（最大 5MB）。

### 如何联系客服？
邮箱：support@formula-ocr.com

## 注意事项

⚠️ `.env` 文件包含敏感信息，请勿提交到 Git！
